# Network 답변 모음 (37-40)

## 37. 본인이 새로운 통신 프로토콜을 TCP나 UDP를 사용해서 구현한다고 하면, 어떤 기준으로 프로토콜을 선택하시겠어요?

새로운 통신 프로토콜을 설계할 때는 **애플리케이션의 요구사항**을 분석하여 TCP와 UDP 중 적합한 것을 선택해야 합니다.

**신뢰성 요구사항:**
데이터의 완전한 전달이 필수적인가를 먼저 고려합니다. 금융 거래, 파일 전송, 데이터베이스 동기화 등은 단 하나의 바이트도 손실되어서는 안 되므로 TCP를 선택합니다. 실시간 스트리밍, 온라인 게임, VoIP 등은 일부 손실을 허용할 수 있으므로 UDP가 적합합니다.

**지연 시간의 중요성:**
실시간성이 중요한 애플리케이션은 UDP를 고려합니다. 게임에서 100ms 이전의 위치 정보는 무의미하며, 재전송받기보다 최신 데이터를 받는 것이 낫습니다. 음성/영상 통화도 약간의 품질 저하는 감수하더라도 낮은 지연이 중요합니다.

**순서 보장의 필요성:**
데이터 순서가 중요하면 TCP를 선택합니다. 텍스트 기반 프로토콜, 파일 다운로드, 데이터베이스 복제 등은 순서가 바뀌면 의미가 달라집니다. 독립적인 메시지 단위로 처리 가능하면 UDP로 애플리케이션 레벨에서 처리할 수 있습니다.

**연결 상태 관리:**
연결 개념이 필요한가를 판단합니다. 세션 기반 서비스, 인증이 필요한 서비스는 TCP의 연결 지향 특성이 유리합니다. 요청-응답 모델의 단순한 질의는 UDP로 충분합니다(예: DNS).

**처리량 대 지연:**
높은 처리량이 목표라면 TCP의 혼잡 제어가 유리합니다. 네트워크를 효율적으로 사용하며 공평성을 보장합니다. 낮은 지연이 목표라면 UDP로 오버헤드를 최소화합니다.

**브로드캐스트/멀티캐스트:**
일대다 통신이 필요하면 UDP를 선택해야 합니다. 네트워크 발견 프로토콜, 실시간 데이터 배포, IoT 센서 네트워크 등에서 활용됩니다.

**네트워크 환경:**
안정적인 데이터센터 내부 통신은 UDP로 오버헤드를 줄일 수 있습니다. 불안정한 무선 네트워크나 인터넷 환경은 TCP의 신뢰성이 필요합니다.

**구현 복잡도:**
빠른 프로토타이핑이 필요하면 TCP를 선택합니다. 신뢰성, 순서 보장 등을 직접 구현할 필요가 없습니다. UDP는 이러한 기능이 필요하면 애플리케이션에서 직접 구현해야 하므로 복잡도가 증가합니다.

**방화벽 통과:**
공공 인터넷을 통한 서비스라면 TCP가 유리합니다. 일부 네트워크에서 UDP를 차단하는 경우가 있습니다. 내부 네트워크에서는 제약이 적습니다.

**기존 인프라:**
로드밸런서, 프록시, 모니터링 도구 등의 지원을 고려합니다. TCP는 생태계가 성숙하여 다양한 도구가 있습니다.

**하이브리드 접근:**
때로는 두 프로토콜을 함께 사용하는 것이 최선입니다. 제어 메시지는 TCP로, 실시간 데이터는 UDP로 전송하는 방식입니다. 게임 서버가 대표적인 예입니다.

**실제 선택 예시:**
- **채팅 애플리케이션**: 메시지 전달 보장이 중요하므로 TCP
- **실시간 주식 시세**: 최신 정보가 중요하고 이전 데이터는 불필요하므로 UDP
- **파일 동기화**: 완벽한 복제가 필요하므로 TCP
- **온라인 FPS 게임**: 낮은 지연이 핵심이므로 UDP
- **REST API**: 신뢰성과 간단한 구현을 위해 TCP

**성능 측정의 중요성:**
이론적 분석 후 실제 환경에서 프로토타입을 테스트하여 성능을 측정하고 검증하는 것이 중요합니다.

---

## 38. DHCP가 무엇인지 설명해 주세요.

**DHCP(Dynamic Host Configuration Protocol)**는 네트워크에 연결된 장치에게 IP 주소와 네트워크 설정 정보를 자동으로 할당하는 프로토콜입니다.

**기본 목적:**
네트워크 관리자가 모든 장치에 수동으로 IP 주소를 설정하는 것은 비효율적이고 오류가 발생하기 쉽습니다. DHCP는 이를 자동화하여 네트워크 관리를 단순화합니다.

**제공하는 정보:**
- **IP 주소**: 네트워크에서 고유한 주소
- **서브넷 마스크**: 네트워크와 호스트 부분을 구분
- **기본 게이트웨이**: 외부 네트워크로 나가는 라우터 주소
- **DNS 서버 주소**: 도메인 이름을 IP 주소로 변환하는 서버
- **임대 시간(Lease Time)**: 할당된 IP 주소를 사용할 수 있는 기간

**동적 할당의 장점:**
IP 주소를 효율적으로 사용할 수 있습니다. 동시 접속자가 전체 장치 수보다 적다면 적은 수의 IP 주소 풀로도 운영 가능합니다. 사용자가 네트워크에서 나가면 IP 주소가 반환되어 다른 사용자가 사용할 수 있습니다.

**자동 구성의 편리성:**
새 장치를 네트워크에 연결하면 자동으로 설정됩니다. 사용자는 복잡한 네트워크 설정을 알 필요가 없습니다. 노트북을 집, 사무실, 카페에서 사용할 때 자동으로 적절한 설정을 받습니다.

**중앙 집중 관리:**
네트워크 설정을 DHCP 서버에서 중앙 관리합니다. DNS 서버 주소를 변경하려면 DHCP 서버 설정만 수정하면 모든 클라이언트에 반영됩니다. 수동 설정의 경우 모든 장치를 일일이 변경해야 합니다.

**IP 주소 충돌 방지:**
DHCP 서버가 할당된 주소를 추적하여 중복 할당을 방지합니다. 수동 설정에서는 실수로 같은 IP를 두 장치에 할당할 수 있습니다.

**임대(Lease) 개념:**
IP 주소는 영구적이 아닌 일정 기간 임대됩니다. 임대 기간의 절반이 지나면 클라이언트는 갱신을 요청합니다. 장치가 오프라인이 되면 임대 만료 후 주소가 회수되어 재사용됩니다.

**예약(Reservation) 기능:**
특정 장치에게 항상 같은 IP 주소를 할당할 수 있습니다. 프린터, 서버 등은 고정 IP가 필요한데, DHCP 예약으로 자동화하면서도 일관된 주소를 유지합니다.

**활용 사례:**
- **가정용 공유기**: 연결된 기기에 자동으로 IP 할당
- **기업 네트워크**: 수천 대의 컴퓨터를 자동 구성
- **공공 Wi-Fi**: 불특정 다수에게 임시 IP 제공
- **IoT 기기**: 설정 없이 네트워크에 자동 연결

**보안 고려사항:**
DHCP는 인증 메커니즘이 약하여 무단 DHCP 서버(Rogue DHCP)가 잘못된 정보를 배포할 수 있습니다. DHCP Snooping 같은 보안 기능으로 대응합니다.

**고가용성:**
중요한 네트워크에서는 여러 DHCP 서버를 운영하여 장애 시에도 서비스를 유지합니다.

**실무적 의미:**
DHCP는 현대 네트워크의 필수 요소로, 사용자 경험을 개선하고 관리 비용을 크게 줄입니다.

---

## 39. DHCP는 몇 계층 프로토콜인가요?

DHCP는 **애플리케이션 계층(7계층) 프로토콜**입니다.

**OSI 7계층 모델에서의 위치:**
애플리케이션 계층은 최상위 계층으로, 사용자나 애플리케이션에 직접적인 서비스를 제공하는 프로토콜들이 위치합니다. DHCP는 IP 주소 할당이라는 특정 서비스를 제공하므로 이 계층에 속합니다.

**전송 계층 프로토콜:**
DHCP는 전송을 위해 UDP를 사용합니다. 서버는 67번 포트를, 클라이언트는 68번 포트를 사용합니다.

**왜 애플리케이션 계층인가:**
계층 분류는 프로토콜이 제공하는 서비스의 성격으로 결정됩니다. DHCP는 네트워크 설정이라는 고수준의 서비스를 제공하므로 애플리케이션 계층입니다. 단순히 데이터 전송이나 라우팅 같은 하위 계층의 기능이 아닙니다.

**UDP 사용의 이유:**
DHCP는 연결 수립 전에 동작해야 하므로 TCP의 연결 지향 특성이 적합하지 않습니다. 클라이언트가 아직 IP 주소가 없는 상태에서 동작해야 하므로 가벼운 UDP가 적합합니다.

**브로드캐스트 통신:**
초기 DHCP Discover 메시지는 브로드캐스트로 전송됩니다. UDP는 브로드캐스트를 지원하지만 TCP는 지원하지 않습니다.

**다른 애플리케이션 계층 프로토콜과의 유사성:**
DNS, HTTP, FTP 등과 같은 계층에 속하며, 모두 특정 서비스를 제공하는 고수준 프로토콜입니다.

**프로토콜 스택:**
DHCP 메시지는 다음과 같이 캡슐화됩니다:
- 애플리케이션 계층: DHCP 메시지
- 전송 계층: UDP 헤더 추가
- 네트워크 계층: IP 헤더 추가
- 데이터링크 계층: 이더넷 프레임 추가

**부트스트랩 문제:**
DHCP는 흥미로운 부트스트랩 문제를 다룹니다. 네트워크 통신을 위해서는 IP 주소가 필요한데, IP 주소를 받기 위해서는 네트워크 통신이 필요합니다. 이를 브로드캐스트와 특수한 주소(0.0.0.0, 255.255.255.255)로 해결합니다.

**상위 프로토콜:**
DHCP는 BOOTP(Bootstrap Protocol)를 확장한 것으로, 두 프로토콜은 같은 포트 번호를 사용하여 호환성을 유지합니다.

**실무적 의미:**
계층 구분을 이해하면 네트워크 문제 해결 시 적절한 레벨에서 진단할 수 있습니다. DHCP 문제는 애플리케이션 레벨 설정을 확인해야 합니다.

---

## 40. DHCP는 어떻게 동작하나요?

DHCP는 **4단계 프로세스**를 통해 IP 주소를 할당합니다. 이를 **DORA(Discover, Offer, Request, Acknowledge)**라고 합니다.

**1단계: DHCP Discover (발견)**
클라이언트가 네트워크에 연결되면 DHCP 서버를 찾기 위해 브로드캐스트 메시지를 전송합니다. 송신 주소는 0.0.0.0(자신의 주소가 없음), 수신 주소는 255.255.255.255(브로드캐스트)입니다. 이 메시지는 같은 네트워크의 모든 장치에게 전달됩니다.

**2단계: DHCP Offer (제안)**
DHCP 서버들이 Discover 메시지를 받으면 사용 가능한 IP 주소를 제안합니다. Offer 메시지에는 제안하는 IP 주소, 서브넷 마스크, 임대 시간, DHCP 서버 주소 등이 포함됩니다. 여러 DHCP 서버가 있다면 각각 Offer를 보낼 수 있습니다.

**3단계: DHCP Request (요청)**
클라이언트는 받은 Offer 중 하나를 선택하여 해당 서버에게 정식으로 IP 주소를 요청합니다. 이 메시지도 브로드캐스트로 전송되어, 선택되지 않은 서버들도 자신의 제안이 거절되었음을 알 수 있습니다. 클라이언트 ID와 요청하는 IP 주소 정보가 포함됩니다.

**4단계: DHCP Acknowledge (확인)**
선택된 DHCP 서버가 IP 주소 할당을 확정하고 ACK 메시지를 보냅니다. 이 메시지에는 최종 네트워크 설정 정보가 모두 포함됩니다: IP 주소, 서브넷 마스크, 게이트웨이, DNS 서버, 임대 시간 등. 클라이언트는 이 정보를 받아 네트워크 인터페이스를 구성합니다.

**임대 갱신 과정:**
IP 주소는 영구적이 아닌 임시 할당입니다. 임대 시간의 50%가 경과하면 클라이언트는 갱신을 시도합니다(T1 타이머). 이때는 브로드캐스트가 아닌 유니캐스트로 해당 DHCP 서버에 직접 Request를 보냅니다. 서버가 ACK로 응답하면 임대가 갱신됩니다.

**임대 재바인딩:**
갱신 시도가 실패하고 임대 시간의 87.5%가 경과하면(T2 타이머) 재바인딩을 시도합니다. 이때는 브로드캐스트로 Request를 보내 다른 DHCP 서버의 응답도 받을 수 있습니다.

**임대 만료:**
모든 갱신 시도가 실패하고 임대가 완전히 만료되면 클라이언트는 IP 주소 사용을 중단합니다. 네트워크 연결이 끊기고, 처음부터 DORA 과정을 다시 시작합니다.

**IP 주소 해제:**
클라이언트가 정상적으로 네트워크를 떠날 때는 DHCP Release 메시지를 보내 IP 주소를 반환합니다. 서버는 즉시 이 주소를 다른 클라이언트에게 할당할 수 있습니다.

**빠른 재연결:**
이전에 사용하던 IP 주소가 있는 클라이언트는 Discover를 생략하고 바로 Request를 보낼 수 있습니다. 서버가 ACK하면 즉시 사용 가능하며, NACK하면 처음부터 다시 시작합니다.

**DHCP Relay Agent:**
DHCP는 브로드캐스트를 사용하므로 같은 네트워크 세그먼트에서만 동작합니다. 다른 네트워크의 DHCP 서버를 사용하려면 라우터가 DHCP Relay Agent 역할을 하여 메시지를 전달합니다.

**상태 확인:**
일부 DHCP 서버는 IP 주소를 할당하기 전에 ICMP Echo(ping)를 보내 해당 주소가 이미 사용 중인지 확인합니다. 충돌을 방지하기 위한 추가 안전장치입니다.

**실무 활용:**
대부분의 사용자는 이 과정을 인식하지 못하지만, Wi-Fi에 연결할 때 몇 초의 대기 시간이 바로 DHCP 과정입니다.
