# Network 답변 모음 (89-92)

## 89. 라우터 내의 포워딩 과정에 대해 설명해 주세요.

**포워딩(Forwarding)**은 라우터가 도착한 패킷을 적절한 출력 인터페이스로 전달하는 과정입니다.

**포워딩의 단계:**

**1단계 - 패킷 수신:**
패킷이 라우터의 입력 인터페이스에 도착합니다. 물리 계층에서 전기/광 신호를 비트로 변환합니다. 데이터링크 계층에서 프레임을 역캡슐화하여 IP 패킷을 추출합니다.

**2단계 - 헤더 검증:**
IP 헤더의 체크섬을 검증합니다. 버전, 헤더 길이, 패킷 크기를 확인합니다. 손상된 패킷은 폐기합니다.

**3단계 - TTL 처리:**
TTL(Time To Live) 값을 1 감소시킵니다. TTL이 0이 되면 패킷을 폐기하고 ICMP Time Exceeded 메시지를 송신자에게 보냅니다. 라우팅 루프를 방지하는 메커니즘입니다.

**4단계 - 목적지 주소 추출:**
IP 헤더에서 목적지 IP 주소를 읽습니다. 이 주소가 포워딩 결정의 핵심입니다.

**5단계 - 포워딩 테이블 조회:**
목적지 IP 주소로 포워딩 테이블(Forwarding Table)을 검색합니다. **최장 접두사 매칭(Longest Prefix Match)**을 사용합니다. 가장 구체적인(긴 접두사) 경로를 선택합니다.

**최장 접두사 매칭 예시:**
목적지: 192.168.1.100
포워딩 테이블:
- 192.168.0.0/16 → 인터페이스 1
- 192.168.1.0/24 → 인터페이스 2
- 0.0.0.0/0 (기본 경로) → 인터페이스 3

결과: /24가 가장 길므로 인터페이스 2를 선택합니다.

**6단계 - 출력 인터페이스 결정:**
포워딩 테이블의 결과로 출력 포트를 결정합니다. 다음 홉(Next Hop) 라우터의 IP 주소도 함께 제공됩니다.

**7단계 - 체크섬 재계산:**
TTL이 변경되었으므로 IP 헤더 체크섬을 다시 계산합니다. 이는 IPv4에만 해당됩니다(IPv6는 체크섬 없음).

**8단계 - ARP 조회:**
다음 홉의 IP 주소를 MAC 주소로 변환합니다. ARP 캐시를 먼저 확인합니다. 캐시에 없으면 ARP 요청을 보냅니다.

**9단계 - 프레임 생성:**
IP 패킷을 데이터링크 프레임으로 캡슐화합니다. 이더넷 헤더에 목적지 MAC 주소(다음 홉), 송신 MAC 주소(라우터 인터페이스)를 설정합니다.

**10단계 - 패킷 전송:**
프레임을 출력 인터페이스의 큐에 넣습니다. 물리 계층이 비트를 신호로 변환하여 전송합니다.

**빠른 경로 vs 느린 경로:**

**빠른 경로(Fast Path):**
대부분의 일반 패킷은 하드웨어(ASIC)에서 처리됩니다. 와이어 스피드로 포워딩됩니다. 소프트웨어 개입이 최소화됩니다.

**느린 경로(Slow Path):**
특수한 경우(ICMP, 옵션 패킷, 첫 패킷)는 CPU로 올라갑니다. 소프트웨어가 처리합니다. 상대적으로 느립니다.

**QoS와 우선순위:**
IP 헤더의 DSCP(Differentiated Services Code Point) 필드를 확인합니다. 우선순위가 높은 패킷(VoIP, 영상 등)을 먼저 전송합니다. 큐 관리로 혼잡을 제어합니다.

**단편화(Fragmentation):**
패킷 크기가 출력 인터페이스의 MTU를 초과하면 단편화합니다. IPv4는 라우터가 단편화할 수 있습니다. IPv6는 송신자만 단편화하며, 라우터는 Packet Too Big ICMP를 보냅니다.

**멀티캐스트:**
목적지가 멀티캐스트 주소면 특별한 처리를 합니다. 여러 출력 인터페이스로 복사하여 전송합니다.

**필터링:**
ACL(Access Control List)을 확인하여 패킷을 허용/차단합니다. 방화벽 규칙을 적용합니다.

**포워딩 테이블 구조:**
일반적으로 트라이(Trie) 구조로 구현됩니다. TCAM(Ternary Content-Addressable Memory)을 사용하여 고속 조회를 수행합니다.

**성능 최적화:**
캐싱: 최근 조회 결과를 캐시합니다. 파이프라이닝: 여러 단계를 병렬 처리합니다. 하드웨어 가속: ASIC, FPGA로 포워딩 로직을 구현합니다.

**라우팅 vs 포워딩:**
라우팅: 경로를 계산하고 테이블을 구축하는 제어 평면. 포워딩: 패킷을 실제로 전달하는 데이터 평면. 포워딩은 라우팅 결과를 사용합니다.

**오류 처리:**
포워딩 테이블에 경로가 없으면 기본 경로(0.0.0.0/0)를 사용합니다. 그것도 없으면 ICMP Destination Unreachable을 송신자에게 보냅니다.

---

## 90. 라우팅과 포워딩의 차이는 무엇인가요?

**라우팅(Routing)**과 **포워딩(Forwarding)**은 네트워크 계층의 서로 다른 기능입니다.

**라우팅(Routing):**

**정의:**
네트워크 토폴로지를 학습하고 최적의 경로를 계산하는 과정입니다.

**역할:**
라우팅 테이블(Routing Table)을 생성하고 유지합니다. 네트워크 변화를 감지하고 업데이트합니다. 여러 경로 중 최선의 경로를 선택합니다.

**주기:**
지속적으로 동작하지만 상대적으로 느린 프로세스입니다. 네트워크 변화가 있을 때 업데이트됩니다. 초 단위에서 분 단위로 동작합니다.

**처리 위치:**
라우터의 CPU(제어 평면)에서 처리됩니다. 소프트웨어로 구현됩니다.

**프로토콜:**
OSPF, BGP, RIP, EIGRP 등의 라우팅 프로토콜을 사용합니다. 정적 라우팅은 관리자가 수동으로 설정합니다.

**목적:**
네트워크 토폴로지를 이해하고 최적 경로를 찾습니다. 라우팅 테이블을 구축합니다.

**포워딩(Forwarding):**

**정의:**
도착한 패킷을 적절한 출력 포트로 전달하는 과정입니다.

**역할:**
포워딩 테이블(Forwarding Table)을 참조합니다. 패킷의 목적지 주소를 보고 출력 인터페이스를 결정합니다. 실제로 패킷을 전송합니다.

**주기:**
패킷이 도착할 때마다 실행됩니다. 마이크로초 단위로 동작합니다. 매우 빠른 처리가 필요합니다.

**처리 위치:**
라우터의 전용 하드웨어(데이터 평면)에서 처리됩니다. ASIC, NPU 등으로 구현됩니다.

**참조:**
포워딩 테이블(라우팅 테이블에서 파생)을 사용합니다. 최장 접두사 매칭(Longest Prefix Match)을 수행합니다.

**목적:**
개별 패킷을 빠르게 전달합니다.

**관계:**

**종속 관계:**
라우팅이 포워딩을 위한 정보를 제공합니다. 라우팅 테이블 → 포워딩 테이블 변환.

**제어 평면 vs 데이터 평면:**
- 라우팅: 제어 평면(Control Plane), 경로 결정
- 포워딩: 데이터 평면(Data Plane), 패킷 전달

**라우팅 테이블 vs 포워딩 테이블:**

**라우팅 테이블:**
라우팅 프로토콜이 학습한 모든 경로를 포함합니다. 여러 경로 중 최선의 경로를 선택하는 정보가 있습니다. 메트릭, 관리 거리, 다음 홉 등 상세 정보를 포함합니다.

**포워딩 테이블:**
라우팅 테이블에서 최선의 경로만 추출한 간소화된 테이블입니다. 빠른 조회를 위해 최적화되어 있습니다. 목적지 네트워크 → 출력 인터페이스 매핑만 포함합니다.

**비유:**

**라우팅:**
지도를 연구하고 모든 가능한 경로를 분석하는 과정입니다. 교통 상황, 거리, 시간을 고려하여 최적 경로를 결정합니다. 한 번 계획하면 여러 번 사용합니다.

**포워딩:**
내비게이션의 음성 안내를 따라 실제로 운전하는 과정입니다. 각 교차로에서 즉시 어느 방향으로 갈지 결정합니다. 빠른 판단이 필요합니다.

**구체적 예시:**

**라우팅 프로세스:**
1. OSPF가 네트워크 토폴로지를 학습합니다
2. 다익스트라 알고리즘으로 최단 경로를 계산합니다
3. 라우팅 테이블에 여러 경로를 저장합니다
4. 최선의 경로를 선택하여 포워딩 테이블을 생성합니다

**포워딩 프로세스:**
1. 패킷이 도착합니다
2. 목적지 IP(192.168.1.100)를 추출합니다
3. 포워딩 테이블에서 조회합니다
4. 매칭되는 경로(192.168.1.0/24 → eth1)를 찾습니다
5. eth1 인터페이스로 패킷을 전송합니다

**SDN(Software-Defined Networking):**

**전통적 라우터:**
라우팅과 포워딩이 같은 장비에 통합되어 있습니다.

**SDN:**
제어 평면(라우팅)과 데이터 평면(포워딩)을 분리합니다. 중앙 컨트롤러가 라우팅을 담당합니다. 스위치는 포워딩만 수행합니다.

**성능 차이:**
- 라우팅: 초당 수천 개의 경로 계산
- 포워딩: 초당 수백만~수십억 개의 패킷 처리

**오류 처리:**

**라우팅 오류:**
경로를 찾지 못하면 기본 경로를 사용합니다. 라우팅 프로토콜 장애 시 이전 정보를 유지합니다.

**포워딩 오류:**
매칭되는 경로가 없으면 ICMP Unreachable을 보냅니다. 인터페이스 다운 시 패킷을 폐기합니다.

**실무 관점:**

**라우터 설정:**
라우팅 프로토콜을 설정하고 관리합니다(show ip route). 경로를 확인하고 문제를 진단합니다.

**성능 모니터링:**
포워딩 성능(pps, throughput)을 측정합니다. 포워딩 테이블 크기와 조회 속도를 최적화합니다.

---

## 91. 라우팅 알고리즘에 대해 설명해 주세요.

**라우팅 알고리즘**은 네트워크에서 최적의 경로를 찾는 방법입니다.

**분류:**

**1. 정적 vs 동적:**

**정적 라우팅(Static Routing):**
관리자가 수동으로 경로를 설정합니다. 네트워크 변화에 자동으로 대응하지 못합니다. 소규모 네트워크나 특정 경로에 사용합니다.

**동적 라우팅(Dynamic Routing):**
라우팅 프로토콜이 자동으로 경로를 학습하고 업데이트합니다. 네트워크 변화에 적응합니다. 대규모 네트워크에 필수적입니다.

**2. 전역 vs 분산:**

**전역 정보(Global/Link-State):**
모든 라우터가 전체 네트워크 토폴로지를 알고 있습니다. 각 라우터가 독립적으로 최단 경로를 계산합니다. OSPF, IS-IS가 대표적입니다.

**분산 정보(Decentralized/Distance-Vector):**
라우터가 인접 라우터로부터 정보를 받습니다. 전체 토폴로지를 모르고 거리 정보만 교환합니다. RIP, EIGRP가 대표적입니다.

**주요 라우팅 알고리즘:**

**1. 다익스트라 알고리즘(Dijkstra's Algorithm):**

**특징:**
링크 상태(Link-State) 알고리즘입니다. 전체 네트워크 토폴로지를 알고 있어야 합니다. 최단 경로 트리(Shortest Path Tree)를 구축합니다.

**동작:**
1. 출발 노드를 초기화합니다
2. 출발 노드로부터 각 노드까지의 최단 거리를 계산합니다
3. 방문하지 않은 노드 중 최단 거리 노드를 선택합니다
4. 선택한 노드를 통한 경로가 더 짧으면 업데이트합니다
5. 모든 노드를 방문할 때까지 반복합니다

**장점:**
최적 경로를 보장합니다. 루프가 발생하지 않습니다. 빠른 수렴(Convergence)이 가능합니다.

**단점:**
모든 노드의 정보가 필요합니다. 계산 복잡도가 O(N²) 또는 O(N log N)입니다. 메모리를 많이 사용합니다.

**사용:**
OSPF, IS-IS 프로토콜이 사용합니다.

**2. 벨만-포드 알고리즘(Bellman-Ford Algorithm):**

**특징:**
거리 벡터(Distance-Vector) 알고리즘입니다. 분산 방식으로 동작합니다. 인접 라우터와 정보를 교환합니다.

**동작:**
1. 각 라우터가 자신의 거리 벡터를 초기화합니다
2. 인접 라우터에게 거리 벡터를 전송합니다
3. 받은 정보로 자신의 테이블을 업데이트합니다
4. 변화가 없을 때까지 반복합니다

**업데이트 공식:**
D(x,y) = min{c(x,v) + D(v,y)} for all neighbors v

**장점:**
구현이 간단합니다. 전체 토폴로지 정보가 불필요합니다. 분산 처리가 가능합니다.

**단점:**
수렴 속도가 느립니다. 카운트 투 인피니티(Count to Infinity) 문제가 있습니다. 라우팅 루프가 발생할 수 있습니다.

**해결책:**
Split Horizon: 받은 방향으로 정보를 되돌려 보내지 않습니다. Poison Reverse: 무한대 거리로 광고합니다. Hold-down Timer: 경로 변경 시 일정 시간 대기합니다.

**사용:**
RIP 프로토콜이 사용합니다.

**3. 경로 벡터(Path Vector):**

**특징:**
전체 경로 정보를 포함합니다. 자율 시스템(AS) 간 라우팅에 사용합니다.

**동작:**
거리뿐 아니라 전체 경로(AS 경로)를 광고합니다. 루프를 쉽게 감지할 수 있습니다(자신이 경로에 있으면 거부).

**사용:**
BGP(Border Gateway Protocol)가 대표적입니다.

**메트릭(Metric):**

**홉 카운트(Hop Count):**
경유하는 라우터 수입니다. RIP가 사용합니다. 단순하지만 대역폭을 고려하지 않습니다.

**대역폭(Bandwidth):**
링크의 전송 속도입니다. 빠른 링크를 선호합니다.

**지연(Delay):**
패킷 전송 시간입니다. 실시간 애플리케이션에 중요합니다.

**비용(Cost):**
관리자가 정의한 값입니다. OSPF가 대역폭 기반 비용을 사용합니다.

**복합 메트릭:**
EIGRP는 대역폭, 지연, 신뢰성, 부하를 종합합니다.

**수렴(Convergence):**

**정의:**
모든 라우터가 일관된 라우팅 정보를 가지는 상태입니다.

**중요성:**
수렴 중에는 라우팅 루프나 블랙홀이 발생할 수 있습니다. 빠른 수렴이 네트워크 안정성에 중요합니다.

**비교:**
- Link-State: 매우 빠름(수초)
- Distance-Vector: 느림(수십 초 ~ 수 분)

**계층적 라우팅:**

**필요성:**
대규모 네트워크에서 모든 경로를 저장하는 것은 불가능합니다.

**영역(Area) 분할:**
네트워크를 영역으로 나눕니다. 영역 내부는 상세 정보, 영역 간은 요약 정보를 사용합니다. OSPF의 Area 개념이 대표적입니다.

**자율 시스템(AS):**
인터넷은 AS 단위로 분할됩니다. AS 내부는 IGP(OSPF, EIGRP), AS 간은 BGP를 사용합니다.

**실무 선택:**

**소규모 네트워크:**
정적 라우팅 또는 간단한 RIP.

**기업 네트워크:**
OSPF 또는 EIGRP(Cisco).

**인터넷 백본:**
BGP로 AS 간 라우팅.

---

## 92. 포워딩 테이블의 구조에 대해 설명해 주세요.

**포워딩 테이블(Forwarding Table)**은 라우터가 패킷을 전달하기 위해 참조하는 자료구조입니다.

**기본 구조:**

**엔트리 구성:**
각 행(엔트리)은 하나의 경로를 나타냅니다. 주요 필드:
- **목적지 네트워크(Destination Network)**: IP 주소와 서브넷 마스크
- **넥스트 홉(Next Hop)**: 다음 라우터의 IP 주소
- **출력 인터페이스(Output Interface)**: 패킷을 보낼 물리 포트
- **메트릭(Metric)**: 경로의 비용
- **플래그(Flags)**: 경로의 속성(직접 연결, 정적, 동적 등)

**예시:**
```
목적지          넷마스크        넥스트홉      인터페이스   메트릭
192.168.1.0    255.255.255.0   직접연결      eth0        0
10.0.0.0       255.0.0.0       192.168.1.1   eth0        10
0.0.0.0        0.0.0.0         192.168.1.254 eth0        1
```

**CIDR 표기:**
```
목적지              넥스트홉      인터페이스
192.168.1.0/24      직접연결      eth0
10.0.0.0/8          192.168.1.1   eth0
0.0.0.0/0           192.168.1.254 eth0
```

**최장 접두사 매칭(Longest Prefix Match):**

**원리:**
패킷의 목적지 IP와 매칭되는 엔트리 중 가장 구체적인(긴 접두사) 것을 선택합니다.

**예시:**
목적지 IP: 192.168.1.100
포워딩 테이블:
- 192.168.0.0/16 → 인터페이스 1
- 192.168.1.0/24 → 인터페이스 2
- 192.168.1.64/26 → 인터페이스 3
- 0.0.0.0/0 → 기본 게이트웨이

결과: /26 (가장 긴 접두사) → 인터페이스 3

**기본 경로(Default Route):**
0.0.0.0/0 또는 ::/0은 모든 주소와 매칭됩니다. 다른 경로가 없을 때 사용됩니다. 일반적으로 인터넷 게이트웨이를 가리킵니다.

**직접 연결 네트워크:**
라우터 인터페이스에 직접 연결된 네트워크입니다. 넥스트 홉 없이 바로 전송할 수 있습니다.

**자료구조 구현:**

**1. 선형 탐색:**
단순한 배열 또는 리스트입니다. 모든 엔트리를 순차적으로 검사합니다. 엔트리 수가 적을 때 간단하지만, 대규모 테이블에서는 느립니다.

**2. 트라이(Trie):**
비트별로 트리를 구성합니다. 빠른 조회(O(W), W는 주소 길이)가 가능합니다. 메모리 효율적입니다.

**3. 패트리시아 트라이(Patricia Trie):**
압축된 트라이로 메모리를 절약합니다. 최장 접두사 매칭에 최적화되어 있습니다.

**4. TCAM(Ternary Content-Addressable Memory):**
하드웨어 기반 병렬 검색입니다. 0, 1, X(don't care) 세 가지 상태를 지원합니다. 모든 엔트리를 동시에 검색하여 매우 빠릅니다(나노초 단위). 고성능 라우터에서 사용합니다.

**5. 해시 테이블:**
고정 길이 주소(/32)에 효과적입니다. 호스트 경로에 사용할 수 있습니다.

**크기:**

**엔터프라이즈 라우터:**
수천 ~ 수만 개 엔트리.

**ISP 라우터:**
수십만 ~ 백만 개 엔트리. 전체 인터넷 라우팅 테이블은 약 90만 개 이상입니다(2024년 기준).

**임베디드/홈 라우터:**
수십 ~ 수백 개 엔트리.

**캐싱:**

**라우트 캐시:**
최근 조회한 결과를 캐시합니다. 동일한 목적지로 향하는 패킷이 많을 때 효과적입니다.

**플로우 캐시:**
5-tuple(프로토콜, 송신 IP, 송신 포트, 수신 IP, 수신 포트)을 키로 캐싱합니다.

**업데이트:**

**라우팅 프로토콜 변경:**
라우팅 테이블이 업데이트되면 포워딩 테이블도 갱신됩니다. 일관성을 유지하기 위해 원자적(atomic) 업데이트를 수행합니다.

**소프트웨어 vs 하드웨어:**
제어 평면(CPU)에서 포워딩 테이블을 구축합니다. 데이터 평면(ASIC)으로 복사하여 실제 포워딩에 사용합니다.

**IPv6:**
IPv6 포워딩 테이블은 별도로 유지됩니다. 128비트 주소로 인해 더 큰 메모리가 필요합니다.

**특수 엔트리:**

**로컬 주소:**
라우터 자신의 IP 주소는 로컬 처리로 표시됩니다.

**브로드캐스트:**
255.255.255.255와 네트워크 브로드캐스트 주소.

**멀티캐스트:**
224.0.0.0/4 범위의 주소는 멀티캐스트 포워딩 테이블을 참조합니다.

**최적화 기법:**

**테이블 압축:**
인접한 네트워크를 집계(Aggregation)하여 엔트리 수를 줄입니다.

**빠른 조회:**
이진 검색, 해시, TCAM 등으로 조회 속도를 최적화합니다.

**병렬 처리:**
여러 포워딩 엔진이 동시에 패킷을 처리합니다.

**모니터링:**
show ip route 명령으로 라우팅 테이블을 확인합니다. show ip cef 명령으로 CEF(Cisco Express Forwarding) 테이블을 확인합니다.
